# Miner Game - Проблемы для исправления

## Критические проблемы:

### 1. Таймер перестал работать

- **Проблема**: Таймер не обновляется, всегда показывает начальное значение
- **Где**: `MinerGameBoard.tsx` - эффект таймера
- **Что проверить**:
  - `timerIntervalRef` создается правильно?
  - `setTimeRemaining` вызывается в интервале?
  - Зависимости `useEffect` для таймера правильные?

### 2. Авто-выбор не работает

- **Проблема**: Когда таймер достигает 0, плитки не открываются автоматически по одной каждые 500мс
- **Где**: `MinerGameBoard.tsx` - логика авто-открытия при `timeRemaining <= 0`
- **Что проверить**:
  - Вызывается ли `autoOpenTiles` когда таймер достигает 0?
  - Правильно ли передается `handleTileClick` через ref?
  - Работает ли `handleTileClick` с параметром `isAutoOpen=true`?
  - Не блокируется ли вызов из-за `playerGameEnded`?

### 3. Ничья все еще возможна

- **Проблема**: В командных режимах может быть ничья (равный счет)
- **Где**: `minerGameLogic.ts` - функция `calculateMinerGameResult`
- **Что проверить**:
  - Используется ли `>=` для сравнения команд (Team A побеждает при равном счете)?
  - В Solo режиме всегда ли есть один победитель?
  - Проверка на ничью в модальном окне?

### 4. Анимации плиток не работают

- **Проблема**: Плитки не переворачиваются (rotateY) при открытии
- **Где**: `MinerGame.tsx` - компонент плитки
- **Что проверить**:
  - Правильно ли устанавливается `isFlipped` на основе `tile.revealed`?
  - Применяется ли `transform: rotateY(180deg)` когда `isFlipped === true`?
  - Есть ли `transition-all duration-300`?
  - Правильно ли настроены `backfaceVisibility` и `transformStyle: preserve-3d`?

### 5. Двойная инициализация

- **Проблема**: Инициализация игры происходит несколько раз
- **Где**: `MinerGameBoard.tsx` - эффект инициализации
- **Что проверить**:
  - Правильно ли работает `initializationStartedRef`?
  - Сбрасывается ли флаг только при размонтировании?
  - Не срабатывает ли эффект несколько раз из-за зависимостей?

## Дополнительные проблемы:

### 6. Счет команд показывает сразу вместо "???"

- **Где**: `TeamBattleLayout.tsx` - расчет счетов команд
- **Что проверить**:
  - Правильно ли работает `shouldHideTeamScores`?
  - Показывается ли "???" до того, как игроки начинают открываться?
  - Счет считается только для `isScoreRevealed === true && willWin === true`?

## Файлы для проверки:

1. `FRONT/SolanaPvP.Front/src/components/game/games/Miner/MinerGameBoard.tsx`

   - Таймер (строки ~397-438)
   - Авто-выбор (строки ~440-570)
   - Инициализация (строки ~138-260)
   - `handleTileClick` (строки ~274-402)

2. `FRONT/SolanaPvP.Front/src/utils/minerGameLogic.ts`

   - `calculateMinerGameResult` - проверка ничьей (строки ~207-280)

3. `FRONT/SolanaPvP.Front/src/components/game/games/Miner/MinerGame.tsx`

   - Анимации плиток (строки ~184-290)
   - `isFlipped` логика (строка ~310)

4. `FRONT/SolanaPvP.Front/src/components/game/TeamBattleLayout.tsx`
   - Расчет счетов команд (строки ~34-42)
   - `hideTeamScores` логика

## Что нужно сделать:

1. **Таймер**: Убедиться, что интервал создается и обновляет `timeRemaining` каждую секунду
2. **Авто-выбор**: Убедиться, что при `timeRemaining <= 0` вызывается `autoOpenTiles` и плитки открываются по одной
3. **Ничья**: Убедиться, что `>=` используется везде и всегда есть победитель
4. **Анимации**: Убедиться, что `isFlipped` правильно устанавливается и анимация применяется
5. **Инициализация**: Убедиться, что `initializationStartedRef` работает правильно и предотвращает двойную инициализацию
